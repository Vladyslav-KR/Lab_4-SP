Звіт до лабораторної роботи №4

Дисципліна: Системне програмування
Тема: Взаємодія з файловою системою Windows. Буферизоване, небуферизоване та асинхронне введення/виведення.
Студент: Кравченко Владислав
Група:КІб12340.д

1. Мета роботи

Ознайомитися з методами взаємодії з файловою системою Windows на рівні системних викликів, навчитися отримувати та змінювати атрибути файлів, порівняти буферизоване та небуферизоване введення/виведення, а також реалізувати асинхронне введення/виведення для обробки декількох потоків даних одночасно.


2. Завдання
1. Реалізувати програму, яка отримує атрибути файлу:
-розмір файлу;
-час створення, останнього доступу та модифікації;
-атрибути (HIDDEN, READONLY, SYSTEM, COMPRESSED тощо);
-інформацію про власника (SID → ім’я користувача);
-права доступу на читання та запис.


Використані WinAPI-функції:

GetFileAttributesA(), GetFileSizeEx(), GetFileTime(),
GetSecurityInfo(), LookupAccountSidA(), CreateFileA().

| Версія | API     | Механізм                        | Очікування                       |
| ------ | ------- | ------------------------------- | -------------------------------- |
| 1      | C stdio | Буферизоване введення/виведення | швидше при великих буферах       |
| 2      | WinAPI  | Небуферизоване, прямий доступ   | можливість оптимізації прапорами |


3. Реалізувати асинхронне введення/виведення:

-відкрити файли із прапором FILE_FLAG_OVERLAPPED;

-для кожного файлу створити структуру OVERLAPPED та Event;

-запускати асинхронні операції ReadFile();

-завершення перевіряти через GetOverlappedResult();

-використовувати WaitForMultipleObjects() для одночасного обслуговування кількох файлів;
-запис даних у вихідні файли.

3. Опис реалізації
3.1. Отримання атрибутів файлу

Програма отримує:
- атрибути (через GetFileAttributes);
- розмір (GetFileSizeEx);
- часи (GetFileTime → FileTimeToSystemTime);
- власника файлу (GetSecurityInfo + LookupAccountSidA);
- можливість відкриття файлу на читання і запис (через пробне відкриття).
Всі дані коректно відображаються відповідно до інформації Провідника Windows.

3.2. Порівняння буферизованого та WinAPI-копіювання

Було реалізовано дві функції:

Буферизоване копіювання (C stdio)
fopen();
fread(buffer, 1, BUF_SIZE, in);
fwrite(buffer, 1, bytesRead, out);


Переваги:
- висока оптимізація бібліотеки C;
- вбудоване буферизування;
- простота реалізації.

WinAPI-копіювання
HANDLE h = CreateFile(...);
ReadFile(...);
WriteFile(...);

Переваги:
- доступ до низькорівневих параметрів;
- можливість встановлювати прапори оптимізації (FILE_FLAG_SEQUENTIAL_SCAN, FILE_FLAG_NO_BUFFERING);
- необхідний набір для асинхронного I/O.

3.3. Асинхронне копіювання кількох файлів

Було реалізовано:
- N файлів, кожен копіюється у власному асинхронному контексті;
- для кожного файлу:
OVERLAPPED ov,
HANDLE event,
окремий буфер,
позиція офсету;

після запуску першого ReadFile, програма чекає на завершення через:
WaitForMultipleObjects(eventList)


4. Результати експериментів
4.1. Порівняння часу копіювання

   | Метод   | Час    |
| ------- | ------ |
| C stdio | 1.42 c |
| WinAPI  | 1.73 c |

- C stdio часто працює трохи швидше завдяки внутрішній оптимізації та буферизації.
- WinAPI дає більший контроль, але вимагає ручної оптимізації (вказання кешування, прапорів).

 4.2. Асинхронне копіювання

При копіюванні 3 великих файлів одночасно, час був:
-послідовне копіювання 3х файлів: ~4.5 с
-асинхронне копіювання (усі 3 одночасно): ~1.8–2.2 с

Асинхронний I/O значно ефективніший, бо:
- CPU не простоює в очікуванні дискових операцій;
- Windows оптимізує планування доступу до диска;
- операції накладаються одна на одну.

  Висновки

Під час виконання лабораторної роботи було:
- досліджено роботу різних WinAPI-функцій для роботи з файлами;
- розроблено програму для аналізу атрибутів і метаданих файлу;
- реалізовано два типи копіювання — буферизоване та низькорівневе;
- експериментально встановлено, що:
C stdio працює швидше при великих буферах;
- WinAPI забезпечує більше контролю над системою;
- реалізовано асинхронне копіювання кількох файлів, що дозволило отримати суттєве прискорення порівняно з послідовним копіюванням.

